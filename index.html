<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Presupuesto El√©ctrico - Ad√°n Serralde</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Roboto', sans-serif; margin: 0; padding: 15px; background: #f5f6f5; color: #1e293b; line-height: 1.4; font-size: 14px; }
    .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border: 1px solid #e2e8f0; }
    header { text-align: center; border-bottom: 2px solid #1a3c6d; padding-bottom: 15px; margin-bottom: 20px; }
    .logo { width: 90px; height: auto; border-radius: 50%; border: 3px solid #1a3c6d; margin-bottom: 8px; }
    h1 { color: #1a3c6d; font-size: 1.8em; margin: 0; text-transform: uppercase; letter-spacing: 1px; }
    .subtitle { color: #475569; font-size: 1em; margin: 5px 0; }
    .contact { font-size: 0.9em; margin: 8px 0; color: #334155; }
    .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 20px; }
    label { font-weight: 500; color: #1a3c6d; display: block; margin-bottom: 4px; font-size: 0.95em; }
    input, textarea, select { width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 5px; font-size: 0.95em; box-sizing: border-box; }
    input:focus, textarea:focus, select:focus { border-color: #1a3c6d; outline: none; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0 10px; font-size: 0.95em; }
    th, td { border: 1px solid #cbd5e1; padding: 8px; text-align: left; }
    th { background: linear-gradient(90deg, #1a3c6d, #2c5282); color: white; font-weight: 600; }
    .qty-col, .price, .subtotal { text-align: right; }
    tfoot td { background: #f8fafc; font-weight: 600; color: #1e293b; }
    .total { font-size: 1.4em; color: #1a3c6d; text-align: right; }
    .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; margin: 8px 4px; transition: all 0.2s; font-weight: 500; }
    .btn-primary { background: #334155; color: white; }
    .btn-primary:hover { background: #475569; }
    .btn-success { background: #475569; color: white; }
    .btn-success:hover { background: #64748b; }
    .btn-add { background: #94a3b8; color: white; font-weight: bold; }
    .btn-add:hover { background: #cbd5e1; color: #1e293b; }
    .section-title { color: #1a3c6d; font-size: 1.2em; margin: 18px 0 10px; border-left: 4px solid #1a3c6d; padding-left: 10px; }
    .actions { text-align: right; margin: 10px 0; }
    .notas { background: #f1f5f9; padding: 12px; border-radius: 6px; font-size: 0.92em; margin: 15px 0; border-left: 4px solid #94a3b8; }
    .notas ul { margin: 8px 0; padding-left: 20px; }
    .notas li { margin-bottom: 6px; }
    .footer { margin-top: 20px; padding-top: 15px; border-top: 1px solid #e2e8f0; font-size: 0.85em; color: #64748b; text-align: center; }
    .signature { font-size: 0.75em; color: #94a3b8; text-align: center; margin-top: 10px; font-style: italic; }
    @media print { .no-print, .signature { display: none !important; } .container { padding: 10px; box-shadow: none; border: none; } }
  </style>
</head>
<body>
  <div class="container" id="presupuesto">
    <header>
      <img src="https://web.whatsapp.com/b1f8a3b5-2abd-46f0-a55f-5b6d75d9bb90" alt="Logo" class="logo">
      <h1>soluciones integrales para el hogar SE.C.A</h1>
      <p class="subtitle">Ad√°n Serralde - reparaci√≥nes Profesionales</p>
      <p class="contact">Los Agaves, Fuentes del Valle, M√©x</p>
      <p class="contact">WhatsApp: 55 6326 6993</p>
    </header>

    <div class="info-grid">
      <div><label>Cliente</label><input type="text" id="cliente" placeholder="Nombre / Raz√≥n Social"></div>
      <div><label>Obra / Direcci√≥n</label><input type="text" id="direccion" placeholder="Calle, colonia, CP"></div>
      <div><label>Tipo</label><select id="tipo"><option>Residencial</option><option>Comercial</option><option>Otro</option></select></div>
      <div><label>Fecha</label><input type="date" id="fecha"></div>
    </div>

    <h2 class="section-title">Partidas</h2>
    <table id="tablaItems">
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Descripci√≥n</th>
          <th class="qty-col">Cant. / Metros</th>
          <th class="price">P. Unit. ($)</th>
          <th class="subtotal">Subtotal</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><select class="tipo-item">
            <option value="cable">Cable (por metro)</option>
            <option value="material">Material (por pieza)</option>
            <option value="tubo">Tubo Conduit (por metro)</option>
          </select></td>
          <td><input type="text" class="desc" placeholder="Elige tipo arriba..."></td>
          <td><input type="number" class="qty" value="1" min="0.1" step="0.1"></td>
          <td><input type="number" class="price" value="0" step="0.01"></td>
          <td class="subtotal">$0.00</td>
        </tr>
      </tbody>
      <tfoot>
        <tr><td colspan="4">Subtotal</td><td id="subtotal">$0.00</td></tr>
        <tr id="iva-row" style="display:none;"><td colspan="4">IVA 16%</td><td id="iva">$0.00</td></tr>
        <tr><td colspan="4" class="total">TOTAL</td><td id="total" class="total">$0.00 MXN</td></tr>
      </tfoot>
    </table>

    <div class="actions no-print">
      <button class="btn btn-add" id="btnAgregar">+ Agregar Partida</button>
    </div>

    <div style="margin: 10px 0; font-size: 0.95em;">
      <label><input type="checkbox" id="aplicarIVA" checked> + IVA 16%</label>
    </div>

    <div class="notas">
      <strong>Condiciones generales:</strong>
      <ul>
        <li>Anticipo del 75% para compra de materiales.</li>
        <li>Pago final al concluir.</li>
        <li>Garant√≠a seg√∫n proveedor en materiales.</li>
        <li>Cumplimiento total con la norma NOM-001-SEDE (instalaci√≥n el√©ctrica de utilizaci√≥n).</li>
        <li>Tiempo estimado de ejecuci√≥n: 3-7 d√≠as h√°biles seg√∫n alcance de la obra.</li>
        <li>Se cobrar√° tiempo extra si hay retrasos imputables al cliente o imprevistos no contemplados.</li>
      </ul>

      <strong>Notas adicionales / Observaciones:</strong>
      <textarea id="notas" rows="3" placeholder="Ej: Incluye visita de supervisi√≥n gratuita, no incluye permisos municipales, servicio en 30 d√≠as m√°ximo, si tarda m√°s por fallas de la instalaci√≥n se dar√° tiempo necesario sin costo extra..."></textarea>
    </div>

    <div class="no-print" style="text-align: center; margin-top: 20px;">
      <button class="btn btn-success" id="btnDescargar">Descargar PNG</button>
      <button class="btn btn-primary" id="btnImprimir">Imprimir / PDF</button>
      <button class="btn btn-primary" id="btnLimpiar">Limpiar</button>
    </div>

    <div class="footer">
      Gracias por su confianza | Ad√°n serralde ‚ö°
    </div>
    <div class="signature">
      Hecho por Shizukuprograms ü§ô
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    const tablaBody = document.querySelector('#tablaItems tbody');
    const aplicarIVA = document.getElementById('aplicarIVA');
    const ivaRow = document.getElementById('iva-row');

    function actualizarTotales() {
      let subtotal = 0;
      document.querySelectorAll('#tablaItems tbody tr').forEach(fila => {
        const qty = parseFloat(fila.querySelector('.qty').value) || 0;
        const price = parseFloat(fila.querySelector('.price').value) || 0;
        const sub = qty * price;
        fila.querySelector('.subtotal').textContent = '$' + sub.toLocaleString('es-MX', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        subtotal += sub;
      });
      let iva = aplicarIVA.checked ? subtotal * 0.16 : 0;
      if (aplicarIVA.checked) document.getElementById('iva').textContent = '$' + iva.toLocaleString('es-MX', {minimumFractionDigits: 2, maximumFractionDigits: 2});
      const total = subtotal + iva;
      document.getElementById('subtotal').textContent = '$' + subtotal.toLocaleString('es-MX', {minimumFractionDigits: 2, maximumFractionDigits: 2});
      document.getElementById('total').textContent = '$' + total.toLocaleString('es-MX', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' MXN';
    }

    function actualizarFila(select) {
      const fila = select.closest('tr');
      const descInput = fila.querySelector('.desc');
      const qtyInput = fila.querySelector('.qty');
      const qtyHeader = fila.closest('table').querySelector('thead th.qty-col');

      const tipo = select.value;
      if (tipo === 'cable') {
        descInput.placeholder = 'Ej: Cable THW 12 AWG (incluye instalaci√≥n por m)';
        qtyInput.step = '0.1';
        qtyInput.min = '0.1';
        qtyHeader.textContent = 'Metros';
      } else if (tipo === 'tubo') {
        descInput.placeholder = 'Ej: Tubo Conduit PVC 3/4" pesado (por m o tramo 3m)';
        qtyInput.step = '0.1';
        qtyInput.min = '0.1';
        qtyHeader.textContent = 'Metros';
      } else {
        descInput.placeholder = 'Ej: Interruptor sencillo o Toma doble';
        qtyInput.step = '1';
        qtyInput.min = '1';
        qtyHeader.textContent = 'Piezas';
      }
      actualizarTotales();
    }

    function agregarFila() {
      const fila = tablaBody.insertRow();
      fila.innerHTML = `
        <td><select class="tipo-item">
          <option value="cable">Cable (por metro)</option>
          <option value="material">Material (por pieza)</option>
          <option value="tubo">Tubo Conduit (por metro)</option>
        </select></td>
        <td><input type="text" class="desc" placeholder="Elige tipo arriba..."></td>
        <td><input type="number" class="qty" value="1" min="0.1" step="0.1"></td>
        <td><input type="number" class="price" value="0" step="0.01"></td>
        <td class="subtotal">$0.00</td>
      `;
      fila.querySelector('.tipo-item').addEventListener('change', function() { actualizarFila(this); });
      fila.querySelectorAll('input').forEach(inp => inp.addEventListener('input', actualizarTotales));
      actualizarFila(fila.querySelector('.tipo-item'));
    }

    // Botones
    document.getElementById('btnAgregar').addEventListener('click', agregarFila);

    document.getElementById('btnDescargar').addEventListener('click', function() {
      html2canvas(document.getElementById('presupuesto'), {scale: 2.5}).then(canvas => {
        const link = document.createElement('a');
        link.download = 'presupuesto-' + (document.getElementById('cliente').value || 'cliente') + '-' + new Date().toISOString().slice(0,10) + '.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    });

    document.getElementById('btnImprimir').addEventListener('click', function() {
      window.print();
    });

    document.getElementById('btnLimpiar').addEventListener('click', function() {
      if (confirm('¬øSeguro que quieres limpiar todo y empezar nuevo?')) {
        document.querySelectorAll('input:not([type="checkbox"]), textarea, select:not(.tipo-item)').forEach(el => {
          if (el.type === 'date') el.value = new Date().toISOString().split('T')[0];
          else el.value = '';
        });
        while (tablaBody.rows.length > 1) tablaBody.deleteRow(1);
        actualizarTotales();
      }
    });

    aplicarIVA.addEventListener('change', () => {
      ivaRow.style.display = aplicarIVA.checked ? 'table-row' : 'none';
      actualizarTotales();
    });

    const primeraTipo = document.querySelector('.tipo-item');
    primeraTipo.addEventListener('change', function() { actualizarFila(this); });
    document.querySelectorAll('#tablaItems input').forEach(inp => inp.addEventListener('input', actualizarTotales));
    actualizarFila(primeraTipo);
    document.getElementById('fecha').value = new Date().toISOString().split('T')[0];
  </script>
</body>
</html>
